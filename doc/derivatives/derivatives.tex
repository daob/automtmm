\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}

\title{Derivatives and standard errors of standardized parameters in the LISREL
model}
\author{Daniel Oberski\\RECSM research paper, Universitat Pompeu Fabra}


\newcommand{\n}{\eta}
\renewcommand{\l}{\lambda}
\renewcommand{\b}{\beta}
\newcommand{\p}{\phi}

\renewcommand{\d}{\,\mathrm{d}\,}

\newcommand{\definedas}{\triangleq}
\newcommand{\kronprod}{\otimes}
\newcommand{\hadaprod}{\circ}

\newcommand{\diag}{\mathrm{diag}}
\renewcommand{\vec}{\mathrm{vec}\,}
\newcommand{\vech}{\mathrm{vech}\,}

\newcommand{\Lambdastan}{\tilde{\Lambda}}
\newcommand{\Bstan}{\tilde{B}}

\newcommand{\0}{\boldsymbol{0}}

\begin{document}
\maketitle

Assume the following model for a vector of observed variables $y$ has been
specified:
\begin{align}
\label{eq:lisrel_observed}
y &= \Lambda \n + \epsilon\\
\n &= B_0 \n + \zeta,\label{eq:lisrel_latent}
\end{align}
where $\n$ is a vector of unobserved variables, $\zeta$ is a vector of
disturbance terms and $\epsilon$ is a vector of measurement errors. Model
\ref{eq:lisrel_latent} implies the following model
$\Sigma_\n(\theta)$ for the variance-covariance matrix of the unobserved
variables: 
\begin{equation}\label{eq:sigma_n}
    \Sigma_\n(\theta) = B^{-1} \Phi B^{-T},
\end{equation}
where $B \definedas I - B_0$ is positive definite, 
and $\Phi$ is the variance-covariance
matrix of $\zeta$. Model \ref{eq:lisrel_observed} can then be seen to imply the
following model $\Sigma_y(\theta)$ for the variance-covariance matrix of the
observed variables:
\begin{equation}\label{eq:sigma_y}
    \Sigma_y(\theta) = \Lambda B^{-1} \Phi B^{-T} \Lambda' + \Psi,
\end{equation}
where  $\Psi$ is the variance-covariance matrix of $\epsilon$. 
We assume throughout that both $\Sigma_y$ and $\Sigma_\n$ are positive
definite. In what follows we will write $\Sigma_.$ for $\Sigma_.(\theta)$ in the
interest of clarity.

The parameters of the model are collected in a parameter
vector $$\theta \definedas [\vec{\Lambda}, \vech{\Phi}, \vec B_0, \vech \Psi].$$
Often, interest focuses not only on the parameters $\theta$, 
but also on the so-called ``standardized'' matrices
$\Lambdastan$ and $\Bstan_0$. These are defined as:
\begin{align}\label{eq:lambda_s}
    \Lambdastan &\definedas D^{-1}_y \Lambda D_\n
    \\
    \Bstan_0 &\definedas D^{-1}_\n B_0 D_\n,\label{eq:beta_s}
\end{align}
where $D_y \definedas \sqrt{I \hadaprod \Sigma_y}$, and 
$D_\n \definedas \sqrt{I \hadaprod \Sigma_\n}$. We now derive the differentials
of these standardized parameter matrices. 

From definition \ref{eq:lambda_s}, 
\begin{multline}\label{eq:dveclam}
\d\vec\Lambdastan = 
    (D_\n \Lambda' \kronprod I_p) \d \vec D_y^{-1} + 
    (D_\n \kronprod D_y^{-1}) \d\vec\Lambda + \\
    (I_q \kronprod D_y^{-1} \Lambda) \d\vec D_\n,
\end{multline}
and from definition \ref{eq:beta_s}, 
\begin{multline}\label{eq:dvecbeta}
\d\vec \Bstan_0 = 
    (D_\n B_0' \kronprod I_p) \d \vec D_\n^{-1} + 
    (D_\n \kronprod D_\n^{-1}) \d\vec B_0 + \\
    (I_q \kronprod D_\n^{-1} B_0) \d\vec D_\n.
\end{multline}

The differentials of the standardized parameter matrices are, thus, 
functions of the differentials of the covariance structure models $\Sigma_y$ and
$\Sigma_\n$.
From Neudecker \& Satorra (1990), the differential of the implied variance
matrix $\Sigma_y$ of the observed variables is:
\begin{equation}\label{eq:delta_y}
\begin{split}
\d\vec \Sigma_y = (I + K) (\Lambda B^{-1} \Phi B^{-T} \kronprod I) 
\d\vec\Lambda 
+ \\
(I + K) (\Lambda B^{-1} \Phi B^{-T} \kronprod \Lambda B^{-1}) \d\vec B_0
+ \\
(\Lambda B^{-1} \kronprod \Lambda B^{-1}) P \d \vech \Phi
+ \\
\d \vech \Psi,
\end{split}
\end{equation}
where the commutation matrix $K$, the duplication matrix $P$, and the operators
$\vec$ and $\vech$ are defined in Magnus and Neudecker (1989).
Let $\Delta_\l$ equal the coefficient matrix
 of $\d\vec\Lambda$ in equation \ref{eq:delta_y}, 
$\Delta_\b$ the coefficient  of $\d\vec B_0$, and
$\Delta_\p$ the coefficient  of $\d\vech\Phi$.


From equation \ref{eq:delta_y} together with equation \ref{eq:sigma_n} the
differential of the variance matrix of $\n$ can be obtained as:
\begin{equation}\label{eq:delta_n}
\begin{split}
\d\vec \Sigma_\n = 
(I + K) (B^{-1} \Phi B^{-T} \kronprod  B^{-1}) \d\vec B_0
+ \\
(B^{-1} \kronprod  B^{-1}) P \d \vech \Phi.
\end{split}
\end{equation}
Let $\Delta^*_\b$ and $\Delta^*_\p$  be the coefficients of $\d\vec B_0$ and
$\d\vech\Phi$ respectively in equation \ref{eq:delta_n}.

Also, let
\begin{align}
    C_{y2} \definedas&
        - (I_p \kronprod \frac{1}{2 (I_p \hadaprod \Sigma_y)^{\frac{3}{2}}})
        \diag[\vec(I_p)],
\\
    C_{\n1} \definedas&
        (I_q \kronprod \frac{1}{2 (I_q \hadaprod \Sigma_\n)^{\frac{1}{2}}})
        \diag[\vec(I_q)],
\\
    C_{\n2} \definedas&
        - (I_q \kronprod \frac{1}{2 (I_q \hadaprod \Sigma_\n)^{\frac{3}{2}}})
        \diag[\vec(I_q)].
\end{align}

Then, applying standard operations on \ref{eq:dveclam} and rearranging terms,
the differential of the standardized $\Lambdastan$ matrix is
\begin{equation}\label{eq:dveclam_final}
\begin{split}
  \d\vec\Lambdastan = &\\
     & [(D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\l + 
        (D_\n \kronprod D_y^{-1})] 
        \d\vec\Lambda +\\
     & [(D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\b + 
        (I_q \kronprod D_y^{-1}\Lambda) C_{\n1} \Delta^*_\b ] 
        \d\vec B_0 +\\
     & [(D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\p + 
        (I_q \kronprod D_y^{-1}\Lambda) C_{\n1} \Delta^*_\p ] 
        \d\vec \Phi +\\
     & (D_\n \Lambda' \kronprod I_p) C_{y2} 
        \d\vec \Psi.
\end{split}\end{equation}
And similarly, the differential of the standardized $\Bstan_0$ matrix from
equation \ref{eq:dvecbeta} is
\begin{equation}\label{eq:dvecbeta_final}
\begin{split}
  \d\vec \Bstan_0 = &\\
     & [\{(D_\n B_0' \kronprod I_q) C_{\n2}  + 
        (I_q \kronprod D_\n^{-1}B_0) C_{\n1} \} \Delta^*_\b +
           (D_\n \kronprod D_\n^{-1})  ] 
        \d\vec B_0 +\\
     & [(D_\n B_0' \kronprod I_q) C_{\n2}  + 
        (I_q \kronprod D_\n^{-1}B_0) C_{\n1} ] \Delta^*_\p 
        \d\vec \Phi.
\end{split}\end{equation}

From the differentials in equations \ref{eq:dveclam_final} and
\ref{eq:dvecbeta_final},
we conclude that the derivative matrices  $G_{\tilde{\l}}$ and 
$G_{\tilde{\b}}$ of the standardized parameters $\vec \Bstan$ and 
$\vec \Lambdastan$ with respect to the free parameters of the model 
$\theta$ will be the partitioned matrices
\begin{multline}
    G_{\tilde{\l}} = [
        (D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\l + 
            (D_\n \kronprod D_y^{-1}), \\
        (D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\p +
         (I_q \kronprod D_y^{-1}\Lambda) C_{\n1} \Delta^*_\p, \\
        (D_\n \Lambda' \kronprod I_p) C_{y2} \Delta_\b + 
            (I_q \kronprod D_y^{-1}\Lambda) C_{\n1} \Delta^*_\b,\\
        (D_\n \Lambda' \kronprod I_p) C_{y2}  
 ] 
\end{multline}
and
\begin{multline}
    G_{\tilde{\b}} = [
        \0,
        \{(D_\n B_0' \kronprod I_q) C_{\n2}  + 
            (I_q \kronprod D_\n^{-1}B_0) C_{\n1} \} \Delta^*_\p
            ,\\
        \{(D_\n B_0' \kronprod I_q) C_{\n2}  + 
            (I_q \kronprod D_\n^{-1}B_0) C_{\n1} \} \Delta^*_\b +
            (D_\n \kronprod D_\n^{-1})
            ,
        \0
 ] .
\end{multline}
\end{document}
